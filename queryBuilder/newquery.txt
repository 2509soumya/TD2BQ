SELECT   CAST('WALMART' AS STRING) AS TENANT , CAST('|' AS STRING),CAST(FACILITY_ID AS STRING) AS FACILITY , CAST('|' AS STRING),CAST(UPC AS STRING) AS UPC , CAST('|' AS STRING),CAST(IS_PARENT AS STRING) AS IS_PARENT , CAST('|' AS STRING),CAST(ITEM_ID AS STRING) AS ITEM_ID , CAST('|' AS STRING),CAST(WM_ITEM_NUMBER AS STRING) AS WM_ITEM_NUMBER , CAST('|' AS STRING),CAST(DESCRIPTION AS STRING) AS DESCRIPTION , CAST('|' AS STRING),CAST(DIVISION_NAME AS STRING) AS DIVISION_NAME , CAST('|' AS STRING),CAST(SUPER_DEPARTMENT_NAME AS STRING) AS SUPER_DEPARTMENT_NAME , CAST('|' AS STRING),CAST(DEPT AS STRING) AS DEPT , CAST('|' AS STRING),CAST(CAT AS STRING) AS CAT , CAST('|' AS STRING),CAST(SUBSTR(SUB_CAT,0,50) AS STRING) AS SUB_CAT , CAST('|$' AS STRING),CAST(AMT_ITEM_PRICE AS STRING) AS CURRENT_RETAIL , CAST('|$' AS STRING),CAST(ITEM_COST AS STRING) AS ITEM_COST , CAST('|' AS STRING),CAST(ATS AS STRING) AS ATS , CAST('|' AS STRING),CAST(TRBL AS STRING) AS TRBL , CAST('|' AS STRING),CAST(RIP AS STRING) AS RIP , CAST('|' AS STRING),CAST(OIP AS STRING) AS OIP , CAST('|' AS STRING),CAST(EIP AS STRING) AS EIP , CAST('|' AS STRING),CAST(WIP AS STRING) AS WIP , CAST('|' AS STRING),CAST(SUM_OH AS STRING) AS SUM_OH , CAST('|$' AS STRING),CAST(EXT_COST AS STRING) AS EXT_COST , CAST('|' AS STRING),CAST(STORE_NUM AS STRING) AS STORE_NUMBER , CAST('|$' AS STRING),CAST(RETAIL_PRICE AS STRING) AS RETAIL_PRICE , CAST('|$' AS STRING),CAST(EXT_RETAIL AS STRING) AS EXT_RETAIL , CAST('|' AS STRING),CAST(VENDOR_NUM AS STRING) AS VENDOR_NUMBER , CAST('|' AS STRING),CAST(DIM_X AS STRING) AS DIM_X , CAST('|' AS STRING),CAST(DIM_Y AS STRING) AS DIM_Y , CAST('|' AS STRING),CAST(DIM_Z AS STRING) AS DIM_Z , CAST('|' AS STRING),CAST(STYLE_ID_NUM AS STRING) AS STYLE_ID_NUM , CAST('|' AS STRING),CAST(COLOR AS STRING) AS COLOR , CAST('|' AS STRING),CAST(SIZE AS STRING) AS SIZE , CAST('|' AS STRING),CAST(WEIGHT AS STRING) AS WEIGHT , CAST('|' AS STRING),CAST('' AS STRING) AS BUNDLE_ID , CAST('|' AS STRING),CAST(IS_CON AS STRING) AS IS_CON , CAST('|' AS STRING),CAST(IS_S2S_ELIGIBLE AS STRING) AS IS_S2S_ELIGIBLE , CAST('|' AS STRING),CAST(IS_S2S_ACTIVE AS STRING) AS IS_S2S_ACTIVE , CAST('|' AS STRING),CAST(IS_BACKHAUL_ELIGIBLE AS STRING) AS IS_BACKHAUL_ELIGIBLE , CAST('|' AS STRING),CAST(ITEM_CUBE AS STRING) AS ITEM_CUBE , CAST('|' AS STRING),CAST(TOTAL_CUBE AS STRING) AS TOTAL_CUBE , CAST('|' AS STRING),CAST(PARENT_UPC AS STRING) AS PARENT_UPC , CAST('|' AS STRING),CAST(FORMAT_DATETIME('%m/%d/%Y',END_DATE) AS STRING) AS END_DATE , CAST('|' AS STRING),CAST(IS_REPLENISHABLE AS STRING) AS IS_REPLENISHABLE , CAST('|' AS STRING),CAST(SUBSTR(OFFR_LIFECYCLE_STS_DESC,0,1) AS STRING) AS DISPLAY_STATUS_DESC , CAST('|' AS STRING),CAST(SUBSTR(AVLBL_STS,0,1) AS STRING) AS AVAILABILITY_STATUS_DESC , CAST('|' AS STRING),CAST(SHPG_NODE_GRP_NM AS STRING) AS DSTRBTR_GRP_NM , CAST('|' AS STRING),CAST(LAST_RCPT_TS AS STRING) AS LAST_RCPT_TS , CAST('|' AS STRING) FROM  ( SELECT   Y.FACILITY_ID,Y.UPC AS UPC ,  CASE   WHEN Y.UPC = Y.PARENT_UPC THEN 'Y'  ELSE 'N' END AS IS_PARENT , Y.ITEM_ID AS ITEM_ID , Y.WM_ITEM_NUM AS WM_ITEM_NUMBER , Y.DESCRIPTION,DIVISION_NAME AS DIVISION_NAME , SUPER_DEPARTMENT_NAME AS SUPER_DEPARTMENT_NAME , DEPT,CAT AS CAT , SUB_CAT,Y.AMT_ITEM_PRICE,MAX(COST) AS ITEM_COST , SUM(ATS) AS ATS , SUM(TRBL) AS TRBL , SUM(RIP) AS RIP , SUM(OIP) AS OIP , SUM(EIP) AS EIP , SUM(WIP) AS WIP , SUM(SUM_OH) AS SUM_OH , SUM(EXT_COST) AS EXT_COST , Y.STORE_NUM,SUM(RETAIL_PRICE) AS RETAIL_PRICE , SUM(EXT_RETAIL) AS EXT_RETAIL , VENDOR_NUM,AVG(SHIP_DIM_X) AS DIM_X , AVG(SHIP_DIM_Y) AS DIM_Y , AVG(SHIP_DIM_Z) AS DIM_Z , Y.STYLE_ID_NUM,Y.COLOR,Y.SIZE,Y.WEIGHT, CASE   WHEN Y.INBOUND_ITEM_CLASS = 'C' THEN 'Y'  ELSE 'N' END AS IS_CON ,  CASE   WHEN PTM.S2S_IND = 1 THEN 'Y'  ELSE 'N' END AS IS_S2S_ELIGIBLE ,  CASE   WHEN PTM.S2S_ACTV_IND = 1 THEN 'Y'  ELSE 'N' END AS IS_S2S_ACTIVE ,  CASE   WHEN PTM.BACKHAUL_ELIG_IND = 1 THEN 'Y'  ELSE 'N' END AS IS_BACKHAUL_ELIGIBLE , CAST(AVG(ITEM_CUBE) AS NUMERIC(38,7)) AS ITEM_CUBE , CAST(AVG(ITEM_CUBE * SUM_OH) AS NUMERIC(38,7)) AS TOTAL_CUBE , Y.PARENT_UPC,Y.END_DATE, CASE   WHEN PTM.REPLENISHABLE_IND = 1 THEN 'Y'  ELSE 'N' END AS IS_REPLENISHABLE , DSL.OFFR_LIFECYCLE_STS_DESC,Y.AVLBL_STS,Y.SHPG_NODE_GRP_NM,Y.LAST_RCPT_TS FROM  ( SELECT   ON_HAND.SHIP_NODE AS FACILITY_ID , ON_HAND.STORE_NUM,ON_HAND.PROD_KEY,ON_HAND.CATLG_ITEM_ID AS ITEM_ID , ON_HAND.WM_ITEM_NUM,ON_HAND.UPC AS UPC , IOH.PARENT_CHILD_FLAG,PROD_NM AS DESCRIPTION , ON_HAND.STYLE_ID_NUM,COLOR,SIZE,SUM(SUM_OH) AS SUM_OH , SUM(ATS) AS ATS , SUM(TRBL) AS TRBL , SUM(RIP) AS RIP , SUM(OIP) AS OIP , SUM(EIP) AS EIP , SUM(WIP) AS WIP , SUM(RTL_PRICE) AS SUM_AMT_ITEM_PRICE , AVG(RTL_PRICE) AS RETAIL_PRICE , SUM(EXT_RTL) AS EXT_RETAIL , SUM(COST) AS SUM_COST , AVG(COST) AS COST , SUM(EXT_COST) AS EXT_COST , MIN(RESERVED_QTY) AS RESERVE , AVG(RTL_PRICE) AS AMT_ITEM_PRICE , PARENT_UPC,INBOUND_ITEM_CLASS,PROD_WT AS WEIGHT , ON_HAND.VEND_NUM AS VENDOR_NUM , AVG(SHIP_DIM_X) AS SHIP_DIM_X , AVG(SHIP_DIM_Y) AS SHIP_DIM_Y , AVG(SHIP_DIM_Z) AS SHIP_DIM_Z , DIV_NM AS DIVISION_NAME , ON_HAND.SUP_DEPT_NM AS SUPER_DEPARTMENT_NAME , ON_HAND.DEPT_NM AS DEPT , ON_HAND.CATEG_NM AS CAT , ON_HAND.SUB_CATEG_NM AS SUB_CAT , AVG(CAST(SHIP_DIM_X AS NUMERIC(38,5)) * CAST(SHIP_DIM_Z AS NUMERIC(38,5)) / (12 * 12 * 12)) AS ITEM_CUBE , AVLBL_STS AS AVLBL_STS , MAX(CAST(FORMAT_DATETIME('%Y-%m-%d',OFFR_END_TS) AS DATE)) AS END_DATE , ODG.SHPG_NODE_GRP_NM,MAX(IPO.LAST_RCPT_TS) AS LAST_RCPT_TS FROM WW_GEC_VM.INVT_INB_ON_HAND_DTL AS ON_HAND LEFT OUTER JOIN WW_GEC_VM.SHPG_NODE_RPT_CONFIG AS ODG  ON ON_HAND.SHIP_NODE_ORG_ID = ODG.SHPG_NODE_ORG_ID AND ODG.RPT_GRP_NM = 'SC_OUTB'  LEFT JOIN (SELECT   CATLG_ITEM_ID,LEGACY_SLR_ID,MIN(AVLBL_STS) AS AVLBL_STS , MIN(RESERVED_QTY) AS RESERVED_QTY FROM WW_GEC_VM.INVT_GLBL_AVLBL AS GLBL LEFT JOIN WW_GEC_VM.INVT_ITEM_LKP AS ITEM_LKP  ON GLBL.PROD_OFFR_ID = ITEM_LKP.SRC_ITEM_ID  LEFT JOIN (SELECT   INVT_ITEM_KEY,TENANT_ORG_ID,SUM( CASE   WHEN INVT_TYP_ID = 30 THEN QTY  ELSE 0 END) AS RESERVED_QTY FROM WW_GEC_VM.INVT_OUTBOUND_SUMM WHERE TENANT_ORG_ID = 4571 AND INVT_TYP_ID = 30 GROUP BY INVT_ITEM_KEY,TENANT_ORG_ID ) AS SUMM  ON ITEM_LKP.INVT_ITEM_KEY = SUMM.INVT_ITEM_KEY  WHERE GLBL.CHNL = 'S2H' AND GLBL.LEGACY_SLR_ID = 0 GROUP BY 1,2 ) AS GLBL_AVAIL  ON ON_HAND.CATLG_ITEM_ID = GLBL_AVAIL.CATLG_ITEM_ID  LEFT OUTER JOIN WW_GEC_VM.INVT_INBOUND_ON_HAND AS IOH  ON IOH.SHIP_NODE_ORG_ID = ON_HAND.SHIP_NODE_ORG_ID AND IOH.REPL_STORE_ORG_ID = ON_HAND.REPL_STORE_ORG_ID AND IOH.UPC = ON_HAND.UPC AND IOH.RPT_DT = ON_HAND.RPT_DT  LEFT JOIN (SELECT   END_SHIP_NODE_ORG_ID,UPC,MAX(LAST_RCPT_TS) AS LAST_RCPT_TS FROM WW_GEC_VM.INVT_INB_PO_OO_RDC_QTY WHERE LAST_RCPT_TS IS NOT NULL GROUP BY 1,2 ) AS IPO  ON IPO.END_SHIP_NODE_ORG_ID = ON_HAND.SHIP_NODE_ORG_ID AND IPO.UPC = ON_HAND.UPC  WHERE ON_HAND.RPT_DT = CURRENT_DATE - 1 GROUP BY ON_HAND.SHIP_NODE,ON_HAND.STORE_NUM,PROD_KEY,ON_HAND.CATLG_ITEM_ID,ON_HAND.WM_ITEM_NUM,ON_HAND.UPC,IOH.PARENT_CHILD_FLAG,ON_HAND.PROD_NM,ON_HAND.STYLE_ID_NUM,COLOR,SIZE,PARENT_UPC,INBOUND_ITEM_CLASS,PROD_WT,ON_HAND.VEND_NUM,DIV_NM,ON_HAND.SUP_DEPT_NM,ON_HAND.DEPT_NM,ON_HAND.CATEG_NM,ON_HAND.SUB_CATEG_NM,AVLBL_STS,ODG.SHPG_NODE_GRP_NM  )  AS Y LEFT JOIN WW_GEC_VM.PROD_TRANSIENT_MASTER AS PTM  ON PTM.PROD_KEY = Y.PROD_KEY  LEFT OUTER JOIN WW_GEC_VM.PROD AS DI  ON DI.CATLG_ITEM_ID = Y.ITEM_ID AND DI.PROD_KEY = Y.PROD_KEY  LEFT OUTER JOIN WW_GEC_VM.PROD_LIFECYCLE_STS_TRK AS PDST  ON PDST.CATLG_ITEM_ID = Y.ITEM_ID  LEFT OUTER JOIN WW_GEC_VM.OFFR_LIFECYCLE_STS_LKP AS DSL  ON DSL.OFFR_LIFECYCLE_STS_ID = PDST.PROD_LIFECYCLE_STS_ID  GROUP BY Y.FACILITY_ID,Y.STORE_NUM,Y.VENDOR_NUM,Y.UPC,IS_PARENT,Y.ITEM_ID,Y.WM_ITEM_NUM,Y.PARENT_UPC,Y.DESCRIPTION,Y.STYLE_ID_NUM,Y.COLOR,Y.SIZE,Y.DIVISION_NAME,Y.SUPER_DEPARTMENT_NAME,Y.DEPT,Y.CAT,Y.SUB_CAT,Y.AMT_ITEM_PRICE,Y.INBOUND_ITEM_CLASS,Y.WEIGHT,PTM.S2S_IND,PTM.S2S_ACTV_IND,PTM.BACKHAUL_ELIG_IND,Y.END_DATE,PTM.REPLENISHABLE_IND,DSL.OFFR_LIFECYCLE_STS_DESC,Y.AVLBL_STS,Y.SHPG_NODE_GRP_NM,Y.LAST_RCPT_TS  )  AS Y1